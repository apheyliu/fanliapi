P2P对接文档
======================

基于P2P理财合作的特殊性，在 :doc:`doc` 的基础上，对部分业务逻辑、订单字段做调整。

.. important::
    文档中标记文字为重要或易误解逻辑，请重点关注。

.. image:: images/p2p.png
   :align: right
   :scale: 50 %

.. _p2p_sp:

特殊逻辑
-----------

.. _p2p_jump:

跳转接口
^^^^^^^^^^

 .. important::
  * P2P理财网站的特殊性，用户跳转注册后，投资行为可能发生在理财APP中，此时订单回传的uid、tc信息为商家记录到的最后一次跳转或注册时的uid、tc信息；如投资发生在PC或H5平台，则仍然按照默认逻辑，返回当次跳转时的跟踪参数；

.. _p2p_order:

订单返回
^^^^^^^^^^

 .. important::

  * 默认约定返利带来的注册用户所有投标均进行推送，商务约定不结佣的新手标、低额标等可以用单独的comm_type进行标识；

  * 返利要求在用户提交投标或支付后即推单，而不可以等到满标/待回款/已回款等状态才推单；如有特例，需双方产品确认；

  * 用户首次投资合作标且投资金额满足合作约定金额，则为 **首投**；若用户首次投资非合作标，不消耗首投资格，如有特例，需双方产品确认。

.. _p2p_order_sample:

订单报文示例
---------------

 .. literalinclude:: /sample/order_p2p.xml
    :language: xml

 .. note::
    * **price/real_pay_fee/coupon** 假设用户投资5000元，使用20元红包，实际支付4980元：
    * 若商务约定不考虑红包，按照金额已满5000元进行结佣，则real_pay_fee=5000；
    * 若商务约定首投/复投结佣金额需扣除红包，按照4980元计算，则real_pay_fee=4980；
    * 上述两种情况，price=5000，coupon=20不变。

